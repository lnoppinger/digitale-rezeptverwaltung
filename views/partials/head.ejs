<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script>
        if(location.protocol == "http:") {
            // Fallback for serviceworker
            let broadcast2 = new BroadcastChannel("serviceworker")
            eventSource = new EventSource("/api/events/monitor",  {
                withCredentials: true
            })
            eventSource.onmessage = async (e) => {
                e.dataJSON = JSON.parse(e.data || "{}")
            
                if(e.data == "{}" || e.dataJSON?.name != "db") return
                location.reload()
            }
        } else if ( (await navigator?.serviceWorker?.getRegistrations())?.length < 1 ) {
            console.log("Install SW")
            await navigator.serviceWorker.register("/serviceworker.js", {
                scope: "/"
            })
        }
    </script>